#!/bin/bash

# Full path of the project
PROJ=`pipenv --where`

# Write environment variables to .env
cat << EOS >> .env
PYTHONPATH=${PROJ}
IPYTHONDIR=${PROJ}/.ipython
MATPLOTLIBRC=${PROJ}/.matplotlib
MPLCONFIGDIR=${PROJ}/.matplotlib
EOS

# Load environment variables
export $(grep -v '^#' .env | xargs)

# Create directories and files
mkdir -p ${IPYTHONDIR}
mkdir -p ${MATPLOTLIBRC}
mkdir -p ${MPLCONFIGDIR}/stylelib
touch ${MATPLOTLIBRC}/matplotlibrc

# Create IPython profile and Jupyter kernel
IPYPROFILE=default
ipython profile create ${IPYPROFILE} --ipython-dir ${IPYTHONDIR}
ipython kernel install --sys-prefix --profile ${IPYPROFILE} --display-name ${IPYPROFILE}

# Create an IPython startup script
cat << EOS > ${IPYTHONDIR}/profile_${IPYPROFILE}/startup/00.py
import os
import re
import sys
import time
from pathlib import Path
from datetime import datetime
from collections import OrderedDict

import numpy as np
import matplotlib.pyplot as plt
EOS

# Create a matplotlib style for the project
cat << EOS > ${MPLCONFIGDIR}/stylelib/project.mpl
figure.figsize: 15, 5
image.cmap: viridis
EOS